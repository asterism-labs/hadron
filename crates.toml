# Hadron crate registry — used by hadron-build for direct rustc compilation.
#
# Each [crate.<name>] defines a compilation unit:
#   path      — relative to project root (or {sysroot} for sysroot crates)
#   edition   — Rust edition
#   type      — "lib" (default), "bin", "proc-macro"
#   context   — "sysroot" | "host" | "userspace" | absent (kernel target)
#   deps      — extern_name = "crate-name" or extern_name = { crate, features, proc-macro }
#   features  — list of features to enable
#   root      — override for crate root file (defaults to src/lib.rs or src/main.rs)

# ===========================================================================
# Sysroot crates (built first, for kernel target)
# ===========================================================================

[crate.core]
path = "{sysroot}/core"
edition = "2024"
context = "sysroot"
root = "src/lib.rs"

[crate.compiler_builtins]
path = "{sysroot}/compiler-builtins/compiler-builtins"
edition = "2024"
context = "sysroot"
root = "src/lib.rs"
features = ["compiler-builtins", "mem", "rustc-dep-of-std"]
deps = { core = "core" }

[crate.alloc]
path = "{sysroot}/alloc"
edition = "2024"
context = "sysroot"
root = "src/lib.rs"
deps = { core = "core", compiler_builtins = "compiler_builtins" }

# ===========================================================================
# Host crates (proc-macro and its dependencies, built for host triple)
# ===========================================================================

[crate.unicode-ident]
path = "vendor/unicode-ident"
edition = "2018"
context = "host"

[crate.proc-macro2]
path = "vendor/proc-macro2"
edition = "2021"
context = "host"
features = ["default", "proc-macro"]
deps = { unicode_ident = "unicode-ident" }

[crate.quote]
path = "vendor/quote"
edition = "2021"
context = "host"
features = ["default", "proc-macro"]
deps = { proc_macro2 = "proc-macro2" }

[crate.syn]
path = "vendor/syn"
edition = "2021"
context = "host"
features = ["full", "extra-traits", "parsing", "printing", "clone-impls", "proc-macro", "derive"]
deps = { proc_macro2 = "proc-macro2", quote = "quote", unicode_ident = "unicode-ident" }

[crate.hadron-syscall-macros]
path = "crates/hadron-syscall-macros"
edition = "2024"
type = "proc-macro"
context = "host"
deps = { syn = "syn", quote = "quote", proc_macro2 = "proc-macro2" }

# ===========================================================================
# Vendored external crates (built for kernel target, no_std)
# ===========================================================================

[crate.bitflags]
path = "vendor/bitflags"
edition = "2021"

[crate.cfg-if]
path = "vendor/cfg-if"
edition = "2018"

[crate.bytemuck]
path = "vendor/bytemuck"
edition = "2018"

# noalloc 0.0.1 from crates.io (used by hadris-common, separate from project noalloc)
[crate.noalloc-vendored]
path = "vendor/noalloc"
edition = "2024"

[crate.hadris-io]
path = "vendor/hadris-io"
edition = "2024"
deps = { bytemuck = "bytemuck", cfg_if = "cfg-if" }

[crate.hadris-common]
path = "vendor/hadris-common"
edition = "2024"
deps = { noalloc = "noalloc-vendored", hadris_io = "hadris-io" }

[crate.hadris-cpio]
path = "vendor/hadris-cpio"
edition = "2024"
features = ["read", "alloc"]
deps = { hadris_io = "hadris-io", hadris_common = "hadris-common" }

# ===========================================================================
# Project crates (built for kernel target)
# ===========================================================================

[crate.noalloc]
path = "crates/noalloc"
edition = "2024"

[crate.hadron-elf]
path = "crates/elf"
edition = "2024"

[crate.hadron-dwarf]
path = "crates/dwarf"
edition = "2024"

[crate.hadron-acpi]
path = "crates/acpi"
edition = "2024"

[crate.limine]
path = "crates/limine"
edition = "2024"
deps = { bitflags = "bitflags" }

[crate.uefi]
path = "crates/uefi"
edition = "2024"
deps = { bitflags = "bitflags" }

[crate.hadron-syscall]
path = "crates/hadron-syscall"
edition = "2024"
features = ["kernel"]
deps = { hadron_syscall_macros = { crate = "hadron-syscall-macros", proc-macro = true } }

[crate.hadron-core]
path = "kernel/hadron-core"
edition = "2024"
deps = { bitflags = "bitflags", hadron_syscall = "hadron-syscall", noalloc = "noalloc" }

[crate.hadron-driver-api]
path = "kernel/hadron-driver-api"
edition = "2024"
deps = { hadron_core = "hadron-core" }

[crate.hadron-drivers]
path = "kernel/hadron-drivers"
edition = "2024"
deps = { bitflags = "bitflags", hadron_core = "hadron-core", hadron_driver_api = "hadron-driver-api" }

[crate.hadron-kernel]
path = "kernel/hadron-kernel"
edition = "2024"
deps = { bitflags = "bitflags", hadris_cpio = "hadris-cpio", hadris_io = "hadris-io", hadron_acpi = "hadron-acpi", hadron_core = "hadron-core", hadron_driver_api = "hadron-driver-api", hadron_drivers = "hadron-drivers", hadron_elf = "hadron-elf", hadron_syscall = "hadron-syscall", noalloc = "noalloc" }

[crate.hadron-boot-limine]
path = "kernel/boot/limine"
edition = "2024"
type = "bin"
root = "src/main.rs"
deps = { hadron_core = "hadron-core", hadron_drivers = "hadron-drivers", hadron_kernel = "hadron-kernel", limine = "limine", noalloc = "noalloc" }

# ===========================================================================
# Userspace crates (built for userspace target)
# ===========================================================================

[crate.hadron-syscall-user]
path = "crates/hadron-syscall"
edition = "2024"
context = "userspace"
features = ["userspace"]
deps = { hadron_syscall_macros = { crate = "hadron-syscall-macros", proc-macro = true } }

[crate.hadron-syslib]
path = "userspace/hadron-syslib"
edition = "2024"
context = "userspace"
deps = { hadron_syscall = "hadron-syscall-user" }

[crate.hadron-init]
path = "userspace/init"
edition = "2024"
type = "bin"
context = "userspace"
root = "src/main.rs"
deps = { hadron_syslib = "hadron-syslib" }
